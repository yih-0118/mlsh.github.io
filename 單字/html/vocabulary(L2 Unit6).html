<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- <link rel="stylesheet" href="{{ url_for("static",filename="style/initialize.min.css" ) }}">
    <link rel="stylesheet" href="{{ url_for("static",filename="style/style.css" ) }}"> -->
    
        <link rel="stylesheet" href="static/style/initialize.min.css">
    <!-- <link rel="stylesheet" href="static/font/font.css"> -->
    <link rel="stylesheet" href="static/style/style.css">


    <script src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>


</head>

<body>
    <div class="app">
        <!-- display -->
        <div class="container">
            <div id="question" class="question" onclick="wp.sound();"></div>
            <div id="hint" class="hint" style="display: none;">
                <span class="type">haha</span> <span class="answer">hhaha</span>
            </div>

            <!-- answer button -->
            <button type="radio" id="answerBtn" class="btn"><i class="fa-solid fa-lightbulb"></i></button>

            <!-- function bar -->
            <div class="rightLeftArea">
                <button id="prev" class="btn"><i class="fa-solid fa-arrow-left"></i></button>
                <button id="next" class="btn"><i class="fa-solid fa-arrow-right"></i></button>
            </div>
        </div>
    </div>
    <div class="panel setting">
        <div class="container">
            <div class="header">
                filename
                <div id="changeData">
                    <button><i class="fa-solid fa-arrows-rotate"></i></button>
                </div>
            </div>
            <div class="block">
                <h3>setting</h3>
                <div class="options " >
                    <div>
                        <input id="mode-1" type="radio" value="1" name="mode" class="mode-set">
                        <label for="mode-1">
                            random
                        </label>
                    </div>
                    <div>
                        <input id="mode-2" type="radio" value="2" name="mode" class="mode-set">
                        <label for="mode-2" class="">
                            順序
                        </label>
                    </div>
                </div>
                <h3>index setting</h3>
                <div class="options">
                    <div>
                        min:
                        <input type="number" name="min" id="val-min" class="amount-set">
                    </div>
                    <div>
                        max:
                        <input type="number" name="max" id="val-max" class="amount-set"class="amount-set">
                    </div>
                </div>
            </div>
            <div class="block">
                <div>
                    <input type="checkbox" id="chinese-display" >
                    <label for="chinese-display">顯示中文</label>
                </div>

                <table class="list">
                    <thead>
                        <th>idx</th>
                        <th>val</th>
                        <th>詞性</th>
                        <th class="chinese">中文</th>
                    </thead>
                    
                </table>
            </div>
        </div>
    </div>
    <button id="menu" class="menu btn round">
        <i class="fa-solid fa-bars"></i>
    </button>



    <script>
        if (localStorage.getItem("update")) {
            localStorage.setItem("update", true);
        } else {
            localStorage.removeItem("number");
            localStorage.removeItem("mode");
            localStorage.removeItem("indexSet"); localStorage.setItem("update", true);
        }
        
        class WordProcessor {
            static data;
            static idx;
            constructor(output, hint, next_btn, prev_btn, hint_btn, finish_load) {
                this.output = $(output);
                this.ans = $(hint);
                this.hint_btn = $(hint_btn);
                this.next_btn = $(next_btn);
                this.prev_btn = $(prev_btn);
                // number
                console.log(localStorage.getItem("number"));
        
                if (localStorage.getItem("number")) {
        
                    if (isNaN(parseInt(localStorage.getItem("number")))) {
                        WordProcessor.idx = 0;
                    } else {
                        WordProcessor.idx = parseInt(localStorage.getItem("number"));
                    }
                } else {
                    localStorage.setItem("number", 0);
                    WordProcessor.idx = 0;
                }
                // data
                if (localStorage.getItem("data")) {
                }
                let self = this;
                WordProcessor.get_data(function (df) {
                    console.log(WordProcessor.data[WordProcessor.idx]);
                    self.output.html(WordProcessor.data[WordProcessor.idx]["vocabulary"])
                    self.ans.children(".type").html(WordProcessor.data[WordProcessor.idx]["partOfSpeech"]);
                    self.ans.children(".answer").html(WordProcessor.data[WordProcessor.idx]["chinese"]);
        
                    for (var i = 0; i < WordProcessor.data.length; i++) {
                        $(".list").append(
                            `<tr class="val"><td class="idx" >${i}</td><td>${WordProcessor.data[i]["vocabulary"]}</td><td>${WordProcessor.data[i]["partOfSpeech"]}</td><td class="chinese">${WordProcessor.data[i]["chinese"]}</td></tr>`
                        )
                    }
                    finish_load();
                });
            }
        
            static get_data(func) {
                $.ajax({
                    type: "GET",
                    url: "./json/vocabulary(L2 Unit6).json",
                    data: "json",
                    dataType: "json",
                    success: function (response) {
                        console.log(response);
                        WordProcessor.data = response["vocabularies"];
                        func();
                    }
                });
            }
        
            static random_idx(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min
            }
            random() {
                WordProcessor.idx = WordProcessor.random_idx(Setting.min, Setting.max);
                localStorage.setItem("number",WordProcessor.idx );
                this.display();
            }
        
            // sound() {
            //     const utterance = new SpeechSynthesisUtterance(this.output.html());
            //     speechSynthesis.speak(utterance);
            // }
        
            display() {
                this.close_hint();
                this.output.html(WordProcessor.data[WordProcessor.idx]["vocabulary"])
                this.ans.children(".type").html(WordProcessor.data[WordProcessor.idx]["partOfSpeech"]);
                this.ans.children(".answer").html(WordProcessor.data[WordProcessor.idx]["chinese"]);
                return WordProcessor.idx
            }
        
            set(idx) {
                WordProcessor.idx = idx;
                localStorage.setItem("number", WordProcessor.idx);
                this.display();
            }
        
            next() {
                if (WordProcessor.idx < Setting.max) {
                    WordProcessor.idx++;
                } else {
                    WordProcessor.idx = 0;
                }
        
                localStorage.setItem("number",WordProcessor.idx );
                this.display();
            }
        
            prev() {
                if (WordProcessor.idx > Setting.min) {
                    WordProcessor.idx--;
                } else {
                    WordProcessor.idx = Setting.max;
                }
                localStorage.setItem("number", WordProcessor.idx);
                this.display();
            }
        
            hint() {
                if (this.ans.is(":hidden")) {
                    this.ans.show();
                } else {
                    this.ans.hide();
                }
            }
            close_hint() {
                this.ans.hide();
            }
        }
        
        class Menu {
            constructor(menu_btn, panel) {
                this.menu_btn = $(menu_btn);
                this.panel = $(panel);
                this.panel.hide();
            }
        
            click() {
                const self = this;
                if (this.panel.is(":hidden")) {
                    this.panel.show();
                    gsap.fromTo(
                        this.panel, {
                        y: "-100%"
                    },
                        {
                            y: 0,
                            ease: "Power",
                            duration: 0.5
                        }
                    );
                } else {
                    gsap.to(this.panel, {
                        opacity: 0,
                        duration: 0.2,
                        onComplete: function () {
                            self.panel.hide();
                            gsap.set(self.panel, { opacity: 1 })
                        }
                    }
                    );
                }
            }
        
        }
        
        class Setting {
            static min = 0;
            static max = 0;
            static mode = 2;
            static data = {};
            constructor() {
                if (localStorage.getItem("indexSet")) {
                    Setting.data = JSON.parse(localStorage.getItem("indexSet"));
                } else {
                    Setting.data = {
                        "min": Setting.min,
                        "max": WordProcessor.data.length - 1
                    }
                    localStorage.setItem("indexSet", JSON.stringify(Setting.data));
                }
                Setting.min = Setting.data["min"];
                Setting.max = Setting.data["max"];
                $(".amount-set").attr("min", Setting.min);
                $(".amount-set").attr("max", Setting.max);
                $("#val-min").val(Setting.min);
                $("#val-max").val(Setting.max);
        
                if (localStorage.getItem("mode")) {
                    $(`#mode-${localStorage.getItem("mode")}`).click();
                    Setting.mode = localStorage.getItem("mode");
                } else {
                    localStorage.setItem("mode", Setting.mode);
        
                    console.log(localStorage.getItem("mode"));
                    $("#mode-2").click();
                }
            }
        
            set(b, amount) {
                amount = parseInt(amount);
                if (WordProcessor.data.length > amount && amount >= 0) {
                    if (b == "min") {
                        Setting.min = amount;
                    } else {
                        Setting.max = amount;
                    }
                } else {
                    if (b == "min") {
                        Setting.min = 0;
                        $("#val-min").val(0);
                    } else {
                        Setting.max = WordProcessor.data.length - 1;
                        $("#val-max").val(Setting.max);
                    }
                }
                Setting.data = {
                    "min": Setting.min,
                    "max": Setting.max
                }
                localStorage.setItem("indexSet", JSON.stringify(Setting.data));
            }
        
            setMode(val) {
                Setting.mode = val;
                console.log(Setting.mode);
                localStorage.setItem("mode", Setting.mode);
            }
        }
        
        let SETTING;
        function val_click() {
            $(".val").on("click", function () {
                console.log("c");
                wp.set(parseInt($(this).children(".idx").html()));
                menu.click();
            })
            SETTING = new Setting();
        
            $("input[name='mode']").click(function () {
                SETTING.setMode(parseInt($("input[name='mode']:checked").val()));
            });
        }
        
        wp = new WordProcessor("#question", "#hint", "#next", "#prev", "#answerBtn", val_click);
        
        // wp.output.on("click", function () {
        //     wp.sound();
        // });
        
        wp.hint_btn.on("click", function () {
            wp.hint();
        })
        
        wp.next_btn.on("click", function () {
            console.log(Setting.mode);
            if (Setting.mode == 2) {
                wp.next();
            } else {
                console.log("click");
                wp.random();
            }
        })
        
        wp.prev_btn.on("click", function () {
            if (Setting.mode == 2) {
                wp.prev();
            } else {
                wp.random();
            }
        })
        
        menu = new Menu("#menu", ".setting")
        
        menu.menu_btn.on("click", function () {
            menu.click();
        })
        
        $('#chinese-display').change(function () {
            if ($(this).is(':checked')) {
                // checkbox 已勾選
                $(".chinese").show();
            } else {
                // checkbox 未勾選
                $(".chinese").hide()
            }
        });
        
        $('#val-min').change(function () {
            SETTING.set("min", $("#val-min").val());
        });
        
        $('#val-max').change(function () {
            SETTING.set("max", $("#val-max").val());
        });
        
        
    </script>
</body>

</html>